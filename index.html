<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Popipi Kids - Studio Pro</title>
    <style>
        :root {
            --bg-app: #6a3093; 
            --side-panel: rgba(0, 0, 0, 0.4);
            --active: #ffff00;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background: var(--bg-app);
            font-family: 'Arial', sans-serif;
        }

        .logo-flutuante { position: absolute; top: 10px; left: 10px; z-index: 100; pointer-events: none; }
        .logo-flutuante img { width: 100px; height: auto; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3)); }

        .app-container { display: flex; width: 100vw; height: 100vh; }

        .sidebar {
            width: 140px; background: var(--side-panel);
            display: flex; flex-direction: column; align-items: center;
            padding: 10px 5px; padding-top: 80px; 
            overflow-y: auto; flex-shrink: 0;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .label { color: white; font-size: 10px; font-weight: bold; margin: 10px 0 5px; text-transform: uppercase; letter-spacing: 1px; }

        .btn {
            width: 50px; height: 50px; border-radius: 12px; border: none; background: white;
            font-size: 24px; cursor: pointer; box-shadow: 0 4px 0 #bbb;
            display: flex; align-items: center; justify-content: center;
        }
        .btn.active { background: var(--active); box-shadow: 0 4px 0 #b3b300; transform: translateY(2px); }

        .c-btn { width: 44px; height: 44px; border-radius: 50%; border: 3px solid white; cursor: pointer; transition: 0.2s; box-sizing: border-box; }
        .c-btn.active { border-color: var(--active); transform: scale(1.1); box-shadow: 0 0 10px var(--active); }

        .main-content { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 10px; position: relative; }
        #viewport { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; touch-action: none; }
        canvas { background: white; border-radius: 5px; box-shadow: 0 15px 40px rgba(0,0,0,0.5); max-width: 95%; max-height: 95%; cursor: crosshair; }

        .sidebar-right { width: 130px; border-left: 1px solid rgba(255,255,255,0.1); padding-top: 10px; overflow-y: auto; }
        .thumb { width: 90px; margin-bottom: 12px; border-radius: 10px; cursor: pointer; background: white; border: 4px solid transparent; }
        .thumb.active { border-color: var(--active); }
        .save-btn-large { grid-column: span 2; width: 100%; background: #2ed573 !important; color: white; font-size: 11px !important; box-shadow: 0 4px 0 #1e9651 !important; }
    </style>
</head>
<body>

<div class="logo-flutuante"><img src="logo.png" alt="Popipi Kids"></div>

<div class="app-container">
    <div class="sidebar">
        <div class="label">Ferramentas</div>
        <div class="grid">
            <button class="btn active" id="brushBtn" onclick="setTool('brush')">‚úèÔ∏è</button>
            <button class="btn" id="fillBtn" onclick="setTool('fill')">ü™£</button>
            <button class="btn" id="eraserBtn" onclick="setTool('eraser')">üßΩ</button>
            <button class="btn" style="background:#ff4757; color:white;" onclick="clearCanvas()">üóëÔ∏è</button>
            <button class="btn save-btn-large" onclick="saveImage()">SALVAR üíæ</button>
        </div>

        <div class="label">Cores</div>
        <div class="grid" id="colorGrid">
            <div class="c-btn" style="background: #FFFFFF; border: 3px solid #ccc;" onclick="selectColor('#FFFFFF', this)"></div>
            <div class="c-btn" style="background: #A9A9A9;" onclick="selectColor('#A9A9A9', this)"></div>
            <div class="c-btn active" style="background: #FFD700;" onclick="selectColor('#FFD700', this)"></div>
            <div class="c-btn" style="background: #FF8C00;" onclick="selectColor('#FF8C00', this)"></div>
            <div class="c-btn" style="background: #FF0000;" onclick="selectColor('#FF0000', this)"></div>
            <div class="c-btn" style="background: #FF1493;" onclick="selectColor('#FF1493', this)"></div>
            <div class="c-btn" style="background: #9400D3;" onclick="selectColor('#9400D3', this)"></div>
            <div class="c-btn" style="background: #00BFFF;" onclick="selectColor('#00BFFF', this)"></div>
            <div class="c-btn" style="background: #32CD32;" onclick="selectColor('#32CD32', this)"></div>
            <div class="c-btn" style="background: #1a1a1a;" onclick="selectColor('#1a1a1a', this)"></div>
            <div class="c-btn" style="background: #00008B;" onclick="selectColor('#00008B', this)"></div>
            <div class="c-btn" style="background: #8B4513;" onclick="selectColor('#8B4513', this)"></div>
        </div>
    </div>

    <div class="main-content">
        <div id="viewport">
            <canvas id="paintCanvas"></canvas>
        </div>
    </div>

    <div class="sidebar sidebar-right">
        <div class="label">Desenhos</div>
        <img src="1.png" class="thumb active" onclick="changeImage('1.png', this)">
        <img src="2.png" class="thumb" onclick="changeImage('2.png', this)">
        <img src="3.png" class="thumb" onclick="changeImage('3.png', this)">
        <img src="4.png" class="thumb" onclick="changeImage('4.png', this)">
        <img src="5.png" class="thumb" onclick="changeImage('5.png', this)">
        <img src="6.png" class="thumb" onclick="changeImage('6.png', this)">
    </div>
</div>

<script>
    const canvas = document.getElementById('paintCanvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    let currentImg = new Image();
    let currentColor = '#FFD700';
    let tool = 'brush';
    let painting = false;

    function loadImage(src) {
        currentImg = new Image();
        currentImg.crossOrigin = "anonymous";
        currentImg.src = src;
        currentImg.onload = () => {
            canvas.width = currentImg.width;
            canvas.height = currentImg.height;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBase();
        };
    }

    function drawBase() {
        ctx.save();
        ctx.globalCompositeOperation = 'multiply';
        ctx.drawImage(currentImg, 0, 0);
        ctx.restore();
    }

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: (clientX - rect.left) * (canvas.width / rect.width),
            y: (clientY - rect.top) * (canvas.height / rect.height)
        };
    }

    canvas.addEventListener('mousedown', start);
    canvas.addEventListener('mousemove', move);
    window.addEventListener('mouseup', () => painting = false);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); start(e.touches[0]); });
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); move(e.touches[0]); });

    function start(e) {
        const pos = getPos(e);
        if (tool === 'fill') {
            const r = parseInt(currentColor.slice(1,3),16);
            const g = parseInt(currentColor.slice(3,5),16);
            const b = parseInt(currentColor.slice(5,7),16);
            floodFill(Math.round(pos.x), Math.round(pos.y), [r, g, b]);
        } else {
            painting = true;
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }
    }

    function move(e) {
        if (!painting || tool === 'fill') return;
        const pos = getPos(e);
        ctx.save();
        ctx.globalCompositeOperation = (tool === 'eraser') ? 'destination-out' : 'source-over';
        ctx.lineWidth = (tool === 'eraser') ? 50 : 20;
        ctx.strokeStyle = currentColor;
        ctx.lineCap = 'round'; ctx.lineJoin = 'round';
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        ctx.restore();
        drawBase();
    }

    function floodFill(startX, startY, fillRGB) {
        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imgData.data;
        const pos = (startY * canvas.width + startX) * 4;
        const targetR = data[pos], targetG = data[pos+1], targetB = data[pos+2];

        if (targetR === fillRGB[0] && targetG === fillRGB[1] && targetB === fillRGB[2]) return;
        if (targetR < 100 && targetG < 100 && targetB < 100) return;

        const stack = [[startX, startY]];
        while (stack.length > 0) {
            const [x, y] = stack.pop();
            const p = (y * canvas.width + x) * 4;
            if (data[p] === targetR && data[p+1] === targetG && data[p+2] === targetB) {
                data[p] = fillRGB[0]; data[p+1] = fillRGB[1]; data[p+2] = fillRGB[2]; data[p+3] = 255;
                if (x + 1 < canvas.width) stack.push([x + 1, y]);
                if (x - 1 >= 0) stack.push([x - 1, y]);
                if (y + 1 < canvas.height) stack.push([x, y + 1]);
                if (y - 1 >= 0) stack.push([x, y - 1]);
            }
        }
        ctx.putImageData(imgData, 0, 0);
        drawBase();
    }

    function selectColor(color, el) {
        currentColor = color;
        document.querySelectorAll('.c-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    function setTool(t) {
        tool = t;
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        document.getElementById(t + 'Btn').classList.add('active');
    }

    function clearCanvas() { if (confirm("Limpar?")) { ctx.clearRect(0,0,canvas.width,canvas.height); drawBase(); } }
    function changeImage(src, el) { loadImage(src); document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active')); el.classList.add('active'); }
    function saveImage() { const link = document.createElement('a'); link.download = 'desenho.png'; link.href = canvas.toDataURL(); link.click(); }

    // Carrega o desenho 1.png ao iniciar
    window.onload = () => loadImage('1.png');
</script>
</body>
</html>
